@page "/"
@inject SmartGirlAlgebra.Services.LocalStorageService LocalStorage

<PageTitle>Smart Girl Algebra</PageTitle>

<!-- Navigation Bar -->
<div class="nav-bar">
    <button class="nav-btn" @onclick="GoHome" title="Home">🏠 Home</button>
    @if (navigationHistory.Count > 1)
    {
        <button class="nav-btn" @onclick="GoBack" title="Back">⬅️ Back</button>
    }
    @if (player != null)
    {
        <div class="nav-user">
            <span>👤 @player.Name</span>
            <button class="nav-btn-small" @onclick="Logout" title="Logout">🚪 Logout</button>
        </div>
    }
</div>

<div class="container">
    @if (player == null)
    {
        <!-- Welcome Screen with HYPER ANIMATIONS! -->
        <div class="card text-center" style="animation: slideIn 0.8s ease-out, pulse 2s ease-in-out infinite;">
            <h2 class="title rainbow-text neon-glow" style="font-size: 3em;">
                <span class="blinking-pompom" style="width: 2.5em; height: 2.5em;"></span>
                Welcome to the Squad!
                <span class="pom-pom" style="font-size: 1em;">📣</span>
            </h2>
            <div class="cheer-jump" style="font-size: 3.75em; margin: 20px 0;">
                📣
            </div>
            <p class="subtitle rainbow-text" style="font-size: 1.5em;">Enter your cheerleader name to begin:</p>
            <input type="text" class="input-field" @bind="playerName" placeholder="Your Name"
                   style="font-size: 1.5em; padding: 20px; border: 3px solid #FF1493; box-shadow: 0 0 20px #FF10F0;" />
            <br/>
            <button class="btn btn-large" @onclick="StartGame"
                    style="font-size: 1.8em; padding: 25px 50px; animation: pulse 1.5s ease-in-out infinite, glow 2s ease-in-out infinite;">
                <span class="blinking-pompom" style="width: 0.75em; height: 0.75em;"></span> Join the Squad! <span class="pom-pom" style="font-size: 0.75em;">📣</span>
            </button>

            <!-- Animated Cheerleaders with POM-POMS -->
            <div style="display: flex; justify-content: space-around; margin-top: 30px; font-size: 2em;">
                <div class="cheer-jump blinking-pompom" style="width: 2em; height: 2em;"></div>
                <div class="split-jump" style="font-size: 1em;">📣</div>
                <div class="cartwheel blinking-pompom" style="width: 2em; height: 2em;"></div>
                <div class="cheer-jump" style="animation-delay: 0.5s; font-size: 1em;">📣</div>
            </div>

            @if (savedPlayers.Any())
            {
                <div style="margin-top: 30px; padding-top: 30px; border-top: 2px solid #eee;">
                    <h3 style="color: var(--primary-pink);">Previous Players:</h3>
                    <div class="saved-players">
                        @foreach (var savedPlayer in savedPlayers)
                        {
                            <button class="saved-player-btn" @onclick="() => LoadPlayer(savedPlayer)">
                                <div class="saved-player-name">👤 @savedPlayer</div>
                                <div class="saved-player-hint">Click to continue</div>
                            </button>
                        }
                    </div>
                </div>
            }
        </div>
    }
    else if (currentScreen == "menu")
    {
        <!-- HYPER-ANIMATED Stats Bar with Pom-Poms! -->
        <div class="stats-bar" style="animation: slideIn 0.5s ease-out; box-shadow: 0 0 30px #FF10F0;">
            <div class="stat-item" style="animation: pulse 2s ease-in-out infinite;">
                <div class="stat-label"><span class="blinking-pompom" style="width: 1.25em; height: 1.25em;"></span> Cheerleader</div>
                <div class="stat-value rainbow-text">@player.Name</div>
            </div>
            <div class="stat-item" style="animation: pulse 2s ease-in-out infinite; animation-delay: 0.2s;">
                <div class="stat-label"><span class="pom-pom" style="font-size: 1.25em;">📣</span> Level</div>
                <div class="stat-value neon-glow">@player.Level</div>
            </div>
            <div class="stat-item" style="animation: pulse 2s ease-in-out infinite; animation-delay: 0.4s;">
                <div class="stat-label"><span class="blinking-pompom" style="width: 1.25em; height: 1.25em;"></span> Points</div>
                <div class="stat-value rainbow-text">@player.Points</div>
            </div>
            <div class="stat-item" style="animation: pulse 2s ease-in-out infinite; animation-delay: 0.6s;">
                <div class="stat-label"><span class="pom-pom" style="font-size: 1.25em;">📣</span> Pom-Poms</div>
                <div class="stat-value neon-glow">@player.PomPoms</div>
            </div>
        </div>

        <!-- HYPER-ANIMATED Main Menu with Pom-Poms! -->
        <div class="card text-center" style="animation: slideIn 0.8s ease-out;">
            <h2 class="title rainbow-text neon-glow" style="font-size: 2.5em;">
                <span class="blinking-pompom" style="width: 2em; height: 2em;"></span> Choose Your Activity <span class="pom-pom" style="font-size: 1em;">📣</span>
            </h2>

            <!-- Animated Cheerleader Squad with POM-POMS -->
            <div style="display: flex; justify-content: center; gap: 30px; margin: 20px 0;">
                <div class="cheer-jump blinking-pompom" style="width: 2.5em; height: 2.5em;"></div>
                <div class="split-jump" style="font-size: 1.25em;">📣</div>
                <div class="cartwheel blinking-pompom" style="width: 2.5em; height: 2.5em;"></div>
                <div class="cheer-jump" style="animation-delay: 1s; font-size: 1.25em;">📣</div>
            </div>

            @if (player.TopicMastery.All(t => t.Value.TotalAttempts == 0))
            {
                <div style="background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%, #FF1493 200%);
                            background-size: 200% 200%;
                            animation: rainbowShift 3s ease infinite;
                            padding: 25px;
                            border-radius: 20px;
                            margin: 20px 0;
                            box-shadow: 0 0 30px #FFD700;">
                    <h3 class="neon-glow" style="color: white; margin: 0 0 10px 0; font-size: 2em;">
                        <span class="blinking-pompom" style="width: 1.25em; height: 1.25em;"></span> NEW PLAYER BONUS! <span class="pom-pom" style="font-size: 0.6em;">📣</span>
                    </h3>
                    <p style="color: white; margin: 0 0 15px 0; font-size: 1.2em;">Take a quick diagnostic to unlock personalized training!</p>
                    <button class="btn" style="background: white; color: #FF1493; font-size: 1.3em; animation: pulse 1.5s ease-in-out infinite;" @onclick="StartDiagnostic">
                        <span class="blinking-pompom" style="width: 0.5em; height: 0.5em;"></span> Start Diagnostic (2 min) <span style="font-size: 0.5em;">📣</span>
                    </button>
                </div>
            }


            <button class="btn" @onclick='() => StartInteractiveMode("balance")'
                    style="animation: glow 2s ease-in-out infinite; font-size: 1.2em;">
                <span class="blinking-pompom" style="width: 0.5em; height: 0.5em;"></span> Balance Scale - Solve by balancing
            </button><br/>
            <button class="btn" @onclick='() => StartInteractiveMode("slider")'
                    style="animation: glow 2s ease-in-out infinite; animation-delay: 0.3s; font-size: 1.2em;">
                <span class="pom-pom" style="font-size: 0.5em;">📣</span> Variable Playground - Explore expressions
            </button><br/>
            <button class="btn" @onclick='() => StartInteractiveMode("builder")'
                    style="animation: glow 2s ease-in-out infinite; animation-delay: 0.6s; font-size: 1.2em;">
                <span class="blinking-pompom" style="width: 0.5em; height: 0.5em;"></span> Equation Builder - Build from word problems
            </button><br/>

            <h3 class="rainbow-text" style="margin: 30px 0 15px 0; font-size: 2em;">
                <span class="pom-pom" style="font-size: 0.6em;">📣</span> Traditional Practice <span class="blinking-pompom" style="width: 1.25em; height: 1.25em;"></span>
            </h3>
            <button class="btn" @onclick='() => StartActivity("adaptive")'
                    style="animation: pulse 2s ease-in-out infinite; font-size: 1.2em;">
                <span class="pom-pom" style="font-size: 0.5em;">📣</span> Adaptive Training - Focus on YOUR weaknesses
            </button><br/>
            <button class="btn" @onclick='() => StartActivity("practice")'
                    style="animation: pulse 2s ease-in-out infinite; animation-delay: 0.3s; font-size: 1.2em;">
                <span class="blinking-pompom" style="width: 0.5em; height: 0.5em;"></span> Practice Mode - Mixed Topics
            </button><br/>
            <button class="btn" @onclick='() => StartActivity("challenge")'
                    style="animation: pulse 2s ease-in-out infinite; animation-delay: 0.6s; font-size: 1.2em;">
                <span class="pom-pom" style="font-size: 0.5em;">📣</span> Challenge Mode - Harder Problems
            </button><br/>

            <button class="btn" @onclick="ViewProgress"
                    style="margin-top: 30px;
                           background: linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #FF1493 100%);
                           background-size: 200% 200%;
                           animation: rainbowShift 3s ease infinite, glow 2s ease-in-out infinite;
                           font-size: 1.3em;
                           padding: 20px 40px;">
                <span class="blinking-pompom" style="width: 0.75em; height: 0.75em;"></span> View Stats & Achievements <span class="pom-pom" style="font-size: 0.75em;">📣</span>
            </button>
        </div>
    }
    else if (currentScreen == "question")
    {
        <!-- HYPER-ANIMATED Stats Bar with POM-POMS -->
        <div class="stats-bar" style="animation: slideIn 0.5s ease-out; box-shadow: 0 0 30px #FF10F0;">
            <div class="stat-item" style="animation: pulse 2s ease-in-out infinite;">
                <div class="stat-label"><span class="blinking-pompom" style="width: 1.25em; height: 1.25em;"></span> Cheerleader</div>
                <div class="stat-value rainbow-text">@player.Name</div>
            </div>
            <div class="stat-item" style="animation: pulse 2s ease-in-out infinite; animation-delay: 0.2s;">
                <div class="stat-label"><span class="pom-pom" style="font-size: 0.6em;">📣</span> Level</div>
                <div class="stat-value neon-glow">@player.Level</div>
            </div>
            <div class="stat-item" style="animation: pulse 2s ease-in-out infinite; animation-delay: 0.4s;">
                <div class="stat-label"><span class="blinking-pompom" style="width: 1.25em; height: 1.25em;"></span> Points</div>
                <div class="stat-value rainbow-text">@player.Points</div>
            </div>
            <div class="stat-item" style="animation: pulse 2s ease-in-out infinite; animation-delay: 0.6s;">
                <div class="stat-label"><span class="pom-pom" style="font-size: 0.6em;">📣</span> Pom-Poms</div>
                <div class="stat-value neon-glow">@player.PomPoms</div>
            </div>
        </div>

        <!-- INTERACTIVE QUESTION SCREEN - NO TEXT INPUT! -->
        <div class="card text-center" style="animation: slideIn 0.8s ease-out; position: relative; overflow: visible;">
            <h2 class="title rainbow-text neon-glow" style="font-size: 2.5em;">
                <span class="blinking-pompom" style="width: 2em; height: 2em;"></span> @activityTitle <span class="pom-pom" style="font-size: 1em;">📣</span>
            </h2>
            <p class="subtitle rainbow-text" style="font-size: 1.5em;">
                Question @(currentQuestionIndex + 1) of @currentQuestions.Count
            </p>

            @if (player.Streak > 0)
            {
                <div class="cheer-jump" style="background: linear-gradient(135deg, #FF1493 0%, #FFD700 50%, #9370DB 100%);
                                               background-size: 200% 200%;
                                               animation: rainbowShift 3s ease infinite, cheer-jump 2s ease-in-out infinite;
                                               color: white;
                                               padding: 15px 30px;
                                               border-radius: 20px;
                                               margin: 20px 0;
                                               display: inline-block;
                                               font-size: 1.5em;
                                               box-shadow: 0 0 30px #FF1493;">
                    🔥 STREAK: @player.Streak 🔥
                </div>
            }

            <!-- Animated POM-POMS cheering you on! -->
            <div style="display: flex; justify-content: space-around; margin: 20px 0;">
                <div class="cheer-jump blinking-pompom" style="width: 2.5em; height: 2.5em;"></div>
                <div class="split-jump" style="font-size: 1.25em;">📣</div>
                <div class="cartwheel blinking-pompom" style="width: 2.5em; height: 2.5em;"></div>
                <div class="cheer-jump" style="animation-delay: 1s; font-size: 1.25em;">📣</div>
            </div>

            <!-- QUESTION with HYPER ANIMATION and POM-POMS -->
            <div style="background: linear-gradient(135deg, #FFD700 0%, #FF69B4 50%, #9370DB 100%);
                        background-size: 200% 200%;
                        animation: rainbowShift 5s ease infinite;
                        padding: 40px;
                        border-radius: 25px;
                        margin: 30px 0;
                        box-shadow: 0 0 40px #FF10F0;
                        transform: perspective(1000px) rotateX(2deg);
                        position: relative;">
                <div class="blinking-pompom" style="position: absolute; top: -50px; left: 20px; width: 2.5em; height: 2.5em;"></div>
                <div class="pom-pom" style="position: absolute; top: -50px; right: 20px; font-size: 1.25em;">📣</div>
                <p class="neon-glow" style="font-size: 2.5em; font-weight: bold; color: white; margin: 0; text-shadow: 3px 3px 6px rgba(0,0,0,0.3);">
                    @currentQuestions[currentQuestionIndex].Question
                </p>
                <p style="font-size: 1.2em; color: white; margin-top: 15px; font-weight: bold;">
                    <span class="blinking-pompom" style="width: 0.75em; height: 0.75em;"></span> Topic: @currentQuestions[currentQuestionIndex].Topic.ToString()
                </p>
            </div>

            @if (displayedHints.Any())
            {
                <div style="background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
                            border-left: 8px solid #FF1493;
                            padding: 25px;
                            margin: 30px 0;
                            text-align: left;
                            border-radius: 15px;
                            box-shadow: 0 0 20px #FFD700;
                            animation: pulse 2s ease-in-out infinite;">
                    <strong class="neon-glow" style="font-size: 1.5em; color: white;">💡 Hints:</strong>
                    @foreach (var hint in displayedHints)
                    {
                        <p style="margin: 10px 0; font-size: 1.2em; color: white; font-weight: bold;">• @hint</p>
                    }
                </div>
            }

            <!-- INTERACTIVE ANSWER METHODS - Rotate through different types! -->
            @{
                var answerType = (currentQuestionIndex % 5); // Rotate through 5 different types
                var correctAnswer = int.Parse(currentQuestions[currentQuestionIndex].Answer);
            }

            @if (answerType == 0)
            {
                <!-- SLIDER ACTIVITY with POM-POMS -->
                <div class="slider-activity" style="animation: slideIn 0.5s ease-out;">
                    <h3 class="rainbow-text" style="font-size: 2em; margin: 20px 0;">
                        <span class="blinking-pompom" style="width: 2em; height: 2em;"></span> Slide to Find the Answer! <span class="pom-pom" style="font-size: 1em;">📣</span>
                    </h3>
                    <div style="font-size: 8em; margin: 20px 0; animation: pulse 1.5s ease-in-out infinite;">
                        <span class="neon-glow">@interactiveAnswer</span>
                    </div>
                    <input type="range" class="game-slider"
                           min="@(Math.Max(-20, correctAnswer - 15))"
                           max="@(correctAnswer + 15)"
                           @bind="interactiveAnswer"
                           @bind:event="oninput"
                           style="width: 80%; height: 30px;" />
                    <br/>
                    <button class="btn" @onclick="CheckInteractiveAnswer"
                            style="font-size: 1.5em;
                                   padding: 20px 50px;
                                   margin-top: 30px;
                                   animation: pulse 1.5s ease-in-out infinite, glow 2s ease-in-out infinite;">
                        <span class="blinking-pompom" style="width: 0.75em; height: 0.75em;"></span> Submit Answer! <span class="pom-pom" style="font-size: 0.75em;">📣</span>
                    </button>
                </div>
            }
            else if (answerType == 1)
            {
                <!-- CLICKING TARGETS ACTIVITY with POM-POMS -->
                <div class="target-activity" style="animation: slideIn 0.5s ease-out;">
                    <h3 class="rainbow-text" style="font-size: 2em; margin: 20px 0;">
                        <span class="pom-pom" style="font-size: 1em;">📣</span> Click the Correct Answer! <span class="blinking-pompom" style="width: 2em; height: 2em;"></span>
                    </h3>
                    <div class="moving-targets" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin: 30px auto; max-width: 600px;">
                        @{
                            var options = GenerateOptions(correctAnswer);
                            foreach (var option in options)
                            {
                                var isSelected = interactiveAnswer == option;
                                <button class="target-btn @(isSelected ? "selected" : "")"
                                        @onclick="() => SelectTarget(option)"
                                        style="font-size: 4em;
                                               padding: 40px;
                                               animation: float 3s ease-in-out infinite, glow 2s ease-in-out infinite;
                                               animation-delay: @(option * 0.1)s;
                                               background: @(isSelected ? "linear-gradient(135deg, #FF1493 0%, #FFD700 100%)" : "linear-gradient(135deg, #9370DB 0%, #00FFFF 100%)");
                                               box-shadow: 0 0 @(isSelected ? "40px" : "20px") @(isSelected ? "#FF1493" : "#9370DB");">
                                    @option
                                </button>
                            }
                        }
                    </div>
                    <button class="btn" @onclick="CheckInteractiveAnswer"
                            style="font-size: 1.5em;
                                   padding: 20px 50px;
                                   animation: pulse 1.5s ease-in-out infinite, glow 2s ease-in-out infinite;">
                        <span class="pom-pom" style="font-size: 0.75em;">📣</span> Submit Answer! <span class="blinking-pompom" style="width: 0.75em; height: 0.75em;"></span>
                    </button>
                </div>
            }
            else if (answerType == 2)
            {
                <!-- BALANCE SCALE ACTIVITY with POM-POMS -->
                <div class="balance-activity" style="animation: slideIn 0.5s ease-out;">
                    <h3 class="rainbow-text" style="font-size: 2em; margin: 20px 0;">
                        <span class="blinking-pompom" style="width: 2em; height: 2em;"></span> Balance the Equation! <span class="pom-pom" style="font-size: 1em;">📣</span>
                    </h3>

                    <!-- Visual Balance Scale -->
                    <div class="balance-scale" style="margin: 40px 0;">
                        <div style="font-size: 3em; animation: swing 2s ease-in-out infinite;">⚖️</div>
                        <div style="display: flex; justify-content: center; gap: 100px; margin: 30px 0; font-size: 2em;">
                            <div class="cheer-jump" style="background: linear-gradient(135deg, #FF1493, #FFD700);
                                                           padding: 30px;
                                                           border-radius: 20px;
                                                           color: white;
                                                           box-shadow: 0 0 30px #FF1493;">
                                <div style="font-size: 0.6em;">Your Answer:</div>
                                <div class="neon-glow" style="font-size: 1.5em;">@interactiveAnswer</div>
                            </div>
                            <div class="split-jump" style="background: linear-gradient(135deg, #9370DB, #00FFFF);
                                                           padding: 30px;
                                                           border-radius: 20px;
                                                           color: white;
                                                           box-shadow: 0 0 30px #9370DB;">
                                <div style="font-size: 0.6em;">Target:</div>
                                <div class="neon-glow" style="font-size: 1.5em;">???</div>
                            </div>
                        </div>
                    </div>

                    <!-- Control Buttons -->
                    <div style="display: flex; justify-content: center; gap: 20px; margin: 30px 0;">
                        <button class="btn" @onclick="() => AdjustBalance(-5)"
                                style="font-size: 3em;
                                       padding: 20px 40px;
                                       animation: pulse 1.5s ease-in-out infinite;">
                            ➖➖
                        </button>
                        <button class="btn" @onclick="() => AdjustBalance(-1)"
                                style="font-size: 3em;
                                       padding: 20px 40px;
                                       animation: pulse 1.5s ease-in-out infinite;
                                       animation-delay: 0.2s;">
                            ➖
                        </button>
                        <button class="btn" @onclick="() => AdjustBalance(1)"
                                style="font-size: 3em;
                                       padding: 20px 40px;
                                       animation: pulse 1.5s ease-in-out infinite;
                                       animation-delay: 0.4s;">
                            ➕
                        </button>
                        <button class="btn" @onclick="() => AdjustBalance(5)"
                                style="font-size: 3em;
                                       padding: 20px 40px;
                                       animation: pulse 1.5s ease-in-out infinite;
                                       animation-delay: 0.6s;">
                            ➕➕
                        </button>
                    </div>

                    <button class="btn" @onclick="CheckInteractiveAnswer"
                            style="font-size: 1.5em;
                                   padding: 20px 50px;
                                   margin-top: 20px;
                                   animation: pulse 1.5s ease-in-out infinite, glow 2s ease-in-out infinite;">
                        <span class="blinking-pompom" style="width: 0.75em; height: 0.75em;"></span> Submit Answer! <span class="pom-pom" style="font-size: 0.75em;">📣</span>
                    </button>
                </div>
            }
            else if (answerType == 3)
            {
                <!-- DRAG & DROP NUMBER TILES with POM-POMS -->
                <div class="drag-activity" style="animation: slideIn 0.5s ease-out;">
                    <h3 class="rainbow-text" style="font-size: 2em; margin: 20px 0;">
                        <span class="pom-pom" style="font-size: 1em;">📣</span> Drag the Correct Number! <span class="blinking-pompom" style="width: 2em; height: 2em;"></span>
                    </h3>

                    <!-- Drop Zone -->
                    <div style="background: linear-gradient(135deg, #FFD700 0%, #FF69B4 100%);
                                padding: 50px;
                                border-radius: 30px;
                                margin: 30px auto;
                                max-width: 400px;
                                box-shadow: 0 0 40px #FFD700;
                                animation: pulse 2s ease-in-out infinite;">
                        <div style="font-size: 1.5em; color: white; margin-bottom: 20px;">Drop Your Answer Here:</div>
                        <div class="neon-glow" style="font-size: 4em;
                                                      color: white;
                                                      min-height: 100px;
                                                      display: flex;
                                                      align-items: center;
                                                      justify-content: center;
                                                      background: rgba(255,255,255,0.2);
                                                      border-radius: 20px;
                                                      border: 5px dashed white;">
                            @(interactiveAnswer != 0 ? interactiveAnswer.ToString() : "?")
                        </div>
                    </div>

                    <!-- Draggable Number Tiles -->
                    <div style="display: grid;
                                grid-template-columns: repeat(4, 1fr);
                                gap: 15px;
                                margin: 30px auto;
                                max-width: 700px;">
                        @{
                            var dragOptions = GenerateOptions(correctAnswer);
                            foreach (var option in dragOptions)
                            {
                                <button class="drag-item pom-pom"
                                        @onclick="() => SelectTarget(option)"
                                        style="font-size: 2.5em;
                                               padding: 30px;
                                               background: linear-gradient(135deg, #9370DB 0%, #00FFFF 100%);
                                               border: none;
                                               border-radius: 20px;
                                               color: white;
                                               cursor: grab;
                                               box-shadow: 0 0 20px #9370DB;
                                               animation: float 3s ease-in-out infinite;
                                               animation-delay: @(option * 0.1)s;
                                               transition: all 0.3s;">
                                    @option
                                </button>
                            }
                        }
                    </div>

                    <button class="btn" @onclick="CheckInteractiveAnswer"
                            style="font-size: 1.5em;
                                   padding: 20px 50px;
                                   animation: pulse 1.5s ease-in-out infinite, glow 2s ease-in-out infinite;">
                        <span class="blinking-pompom" style="width: 0.75em; height: 0.75em;"></span> Submit Answer! <span class="pom-pom" style="font-size: 0.75em;">📣</span>
                    </button>
                </div>
            }
            else if (answerType == 4)
            {
                <!-- CHEERLEADER JUMP COUNTER with POM-POMS -->
                <div style="animation: slideIn 0.5s ease-out;">
                    <h3 class="rainbow-text" style="font-size: 2em; margin: 20px 0;">
                        <span class="blinking-pompom" style="width: 2em; height: 2em;"></span> Make the Cheerleader Jump to the Answer! <span class="pom-pom" style="font-size: 1em;">📣</span>
                    </h3>

                    <!-- Cheerleader that jumps based on answer -->
                    <div style="margin: 40px 0; position: relative; height: 300px;">
                        <div class="cheer-jump"
                             style="font-size: 3.75em;
                                    position: absolute;
                                    bottom: @(interactiveAnswer * 10)px;
                                    left: 50%;
                                    transform: translateX(-50%);
                                    transition: bottom 0.5s ease-out;">
                            📣
                        </div>
                        <div style="position: absolute;
                                    bottom: 0;
                                    left: 0;
                                    right: 0;
                                    height: 5px;
                                    background: linear-gradient(90deg, #FF1493, #FFD700, #00FFFF, #9370DB);"></div>
                    </div>

                    <!-- Jump Counter Display -->
                    <div style="background: linear-gradient(135deg, #FF1493 0%, #FFD700 100%);
                                padding: 30px;
                                border-radius: 25px;
                                margin: 30px auto;
                                max-width: 400px;
                                box-shadow: 0 0 40px #FF1493;
                                animation: pulse 2s ease-in-out infinite;">
                        <div style="font-size: 1.5em; color: white; margin-bottom: 10px;">Jump Count:</div>
                        <div class="neon-glow" style="font-size: 8em; color: white;">@interactiveAnswer</div>
                    </div>

                    <!-- Jump Control Buttons -->
                    <div style="display: flex; justify-content: center; gap: 20px; margin: 30px 0;">
                        <button class="btn" @onclick="() => AdjustBalance(-1)"
                                style="font-size: 2em;
                                       padding: 20px 40px;
                                       animation: pulse 1.5s ease-in-out infinite;">
                            ⬇️ Less
                        </button>
                        <button class="btn" @onclick="() => interactiveAnswer = 0"
                                style="font-size: 2em;
                                       padding: 20px 40px;
                                       animation: pulse 1.5s ease-in-out infinite;
                                       animation-delay: 0.3s;">
                            🔄 Reset
                        </button>
                        <button class="btn" @onclick="() => AdjustBalance(1)"
                                style="font-size: 2em;
                                       padding: 20px 40px;
                                       animation: pulse 1.5s ease-in-out infinite;
                                       animation-delay: 0.6s;">
                            ⬆️ More
                        </button>
                    </div>

                    <button class="btn" @onclick="CheckInteractiveAnswer"
                            style="font-size: 1.5em;
                                   padding: 20px 50px;
                                   margin-top: 20px;
                                   animation: pulse 1.5s ease-in-out infinite, glow 2s ease-in-out infinite;">
                        <span class="pom-pom" style="font-size: 0.75em;">📣</span> Submit Answer! <span class="blinking-pompom" style="width: 0.75em; height: 0.75em;"></span>
                    </button>
                </div>
            }

            @if (currentHintIndex < currentQuestions[currentQuestionIndex].Hints.Count)
            {
                <button class="btn" style="background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
                                           color: white;
                                           font-size: 1.3em;
                                           padding: 15px 30px;
                                           margin-top: 20px;
                                           animation: glow 2s ease-in-out infinite;"
                        @onclick="ShowHint">
                    <span class="blinking-pompom" style="width: 0.75em; height: 0.75em;"></span> Get Hint (@(currentQuestions[currentQuestionIndex].Hints.Count - currentHintIndex) left) <span class="pom-pom" style="font-size: 0.75em;">📣</span>
                </button>
            }
        </div>
    }
    else if (currentScreen == "feedback")
    {
        <!-- HYPER-ANIMATED Feedback Screen with POM-POMS -->
        <div class="card text-center" style="animation: slideIn 0.5s ease-out;">
            @if (isCorrect)
            {
                <!-- CELEBRATION MODE with POM-POMS! -->
                <div style="font-size: 5em; margin: 20px 0;">
                    <div class="cheer-jump">📣</div>
                </div>

                <div style="display: flex; justify-content: space-around; margin: 30px 0;">
                    <div class="cheer-jump blinking-pompom" style="width: 3em; height: 3em;"></div>
                    <div class="split-jump" style="font-size: 1.5em;">📣</div>
                    <div class="cartwheel blinking-pompom" style="width: 3em; height: 3em;"></div>
                    <div class="cheer-jump" style="animation-delay: 0.5s; font-size: 1.5em;">📣</div>
                </div>

                @foreach (var response in wittyResponses)
                {
                    <div class="feedback-correct rainbow-text neon-glow"
                         style="animation: bounce 0.5s, pulse 2s ease-in-out infinite;
                                font-size: 2.5em;
                                margin: 20px 0;
                                text-shadow: 3px 3px 6px rgba(0,0,0,0.3);">
                        @response
                    </div>
                }

                @if (!string.IsNullOrEmpty(newAchievement))
                {
                    <div style="background: linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #FF1493 100%);
                                background-size: 200% 200%;
                                animation: rainbowShift 3s ease infinite, pulse 1.5s ease-in-out infinite;
                                color: white;
                                padding: 30px;
                                border-radius: 25px;
                                margin: 30px 0;
                                box-shadow: 0 0 40px #FFD700;
                                font-size: 1.5em;">
                        <div style="font-size: 2.5em; margin-bottom: 15px;">📣</div>
                        <div class="neon-glow">@newAchievement</div>
                    </div>
                }

                <!-- Animated Pom-Poms celebrating! -->
                <div style="display: flex; justify-content: center; gap: 20px; margin: 30px 0;">
                    <span class="blinking-pompom" style="width: 3em; height: 3em;"></span>
                    <span class="pom-pom" style="animation-delay: 0.2s; font-size: 1.5em;">📣</span>
                    <span class="blinking-pompom" style="animation-delay: 0.4s; width: 3em; height: 3em;"></span>
                    <span class="pom-pom" style="animation-delay: 0.6s; font-size: 1.5em;">📣</span>
                    <span class="blinking-pompom" style="animation-delay: 0.8s; width: 3em; height: 3em;"></span>
                </div>
            }
            else
            {
                <!-- ENCOURAGEMENT MODE with POM-POMS -->
                <div style="font-size: 3.75em; margin: 20px 0;">
                    <div class="cheer-jump">📣</div>
                </div>

                <div class="feedback-incorrect rainbow-text"
                     style="font-size: 2em;
                            animation: shake 0.5s;
                            margin: 20px 0;">
                    @wittyResponses.FirstOrDefault()
                </div>

                <div style="background: linear-gradient(135deg, #FFD700 0%, #FF69B4 100%);
                            padding: 30px;
                            border-radius: 25px;
                            margin: 30px 0;
                            box-shadow: 0 0 30px #FFD700;
                            animation: pulse 2s ease-in-out infinite;">
                    <p class="neon-glow" style="font-size: 2em; margin: 15px 0; color: white;">
                        The correct answer is: <strong style="font-size: 1.5em;">@currentQuestions[currentQuestionIndex].Answer</strong>
                    </p>
                    <p style="font-size: 1.3em; margin: 15px 0; color: white; font-weight: bold;">
                        @currentQuestions[currentQuestionIndex].Explanation
                    </p>
                </div>

                <!-- Encouraging pom-poms -->
                <div style="display: flex; justify-content: center; gap: 30px; margin: 30px 0;">
                    <div class="cheer-jump blinking-pompom" style="width: 3em; height: 3em;"></div>
                    <div class="split-jump" style="font-size: 1.5em;">📣</div>
                    <div class="cheer-jump blinking-pompom" style="animation-delay: 0.5s; width: 3em; height: 3em;"></div>
                </div>
            }
            <button class="btn" @onclick="NextQuestion"
                    style="font-size: 1.8em;
                           padding: 25px 60px;
                           margin-top: 30px;
                           animation: pulse 1.5s ease-in-out infinite, glow 2s ease-in-out infinite;">
                <span class="pom-pom">@(currentQuestionIndex < currentQuestions.Count - 1 ? "➡" : "🏁")</span>
                @(currentQuestionIndex < currentQuestions.Count - 1 ? "Next Question" : "See Results")
                <span class="pom-pom">@(currentQuestionIndex < currentQuestions.Count - 1 ? "➡" : "🏁")</span>
            </button>
        </div>
    }
    else if (currentScreen == "results")
    {
        <!-- Results Screen -->
        <div class="card text-center">
            @{
                double percentage = (double)correctAnswers / currentQuestions.Count * 100;
                string resultTitle = percentage >= 80 ? "🌟 OUTSTANDING! 🌟" :
                                    percentage >= 60 ? "👍 GOOD JOB! 👍" :
                                    "💪 KEEP PRACTICING! 💪";
                string resultColor = percentage >= 80 ? "var(--success-green)" :
                                    percentage >= 60 ? "orange" : "var(--error-red)";
            }
            <h2 class="title" style="color: @resultColor">@resultTitle</h2>
            <p class="subtitle">Score: @correctAnswers/@currentQuestions.Count (@percentage.ToString("F0")%)</p>

            @if (percentage >= 80)
            {
                <p style="font-size: 1.5em; color: var(--primary-pink); margin: 20px 0;">
                    🎉 LEVEL UP! You're now level @player.Level! 🎉
                </p>
            }

            @if (bonusPomPoms > 0)
            {
                <p style="font-size: 1.3em; color: var(--primary-pink); margin: 20px 0;">
                    <span class="blinking-pompom" style="width: 0.75em; height: 0.75em;"></span> Bonus! You earned @bonusPomPoms Pom-Pom(s)! <span style="font-size: 0.75em;">📣</span>
                </p>
            }

            <button class="btn" @onclick="BackToMenu">🏠 Back to Main Menu</button>
        </div>
    }
    else if (currentScreen == "interactive")
    {
        <!-- Interactive Learning Screens -->
        @if (interactiveMode == "balance")
        {
            <BalanceScale
                Instruction="Solve for x by balancing the equation"
                LeftTerms="balanceLeftTerms"
                RightTerms="balanceRightTerms"
                Solution="balanceSolution"
                OnSolved="HandleInteractiveSolved" />
            <button class="btn" @onclick="BackToMenu" style="margin-top: 20px;">🏠 Back to Menu</button>
        }
        else if (interactiveMode == "slider")
        {
            <VariableSlider
                Expression="sliderExpression"
                Instruction="Move the slider to see how the expression changes!"
                ShowVisual="true"
                Challenge="sliderChallenge"
                TargetValue="sliderTarget"
                OnChallengeComplete="HandleInteractiveSolved" />
            <button class="btn" @onclick="BackToMenu" style="margin-top: 20px;">🏠 Back to Menu</button>
        }
        else if (interactiveMode == "builder")
        {
            <EquationBuilder
                WordProblem="builderProblem"
                CorrectEquation="builderAnswer"
                AvailableTiles="builderTiles"
                OnCorrect="HandleInteractiveSolved" />
            <button class="btn" @onclick="BackToMenu" style="margin-top: 20px;">🏠 Back to Menu</button>
        }
    }
    else if (currentScreen == "progress")
    {
        <!-- Progress Screen -->
        <div class="card">
            <h2 class="title">📊 YOUR ALGEBRA MASTERY 📊</h2>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                <div style="background: linear-gradient(135deg, #FF1493 0%, #9370DB 100%); color: white; padding: 20px; border-radius: 15px;">
                    <div style="font-size: 2em; font-weight: bold;">@player.Level</div>
                    <div>Level</div>
                </div>
                <div style="background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); color: white; padding: 20px; border-radius: 15px;">
                    <div style="font-size: 2em; font-weight: bold;">@player.Points</div>
                    <div>Points</div>
                </div>
                <div style="background: linear-gradient(135deg, #90EE90 0%, #32CD32 100%); color: white; padding: 20px; border-radius: 15px;">
                    <div style="font-size: 2em; font-weight: bold;">@player.BestStreak</div>
                    <div>Best Streak</div>
                </div>
                <div style="background: linear-gradient(135deg, #FF69B4 0%, #FF1493 100%); color: white; padding: 20px; border-radius: 15px;">
                    <div style="font-size: 2em; font-weight: bold;">@player.Achievements.Count</div>
                    <div>Achievements</div>
                </div>
            </div>

            <h3 style="color: var(--primary-pink); margin: 30px 0 15px 0;">🎯 Topic Mastery</h3>
            @foreach (var topic in player.TopicMastery.Where(t => t.Value.TotalAttempts > 0).OrderByDescending(t => t.Value.Accuracy))
            {
                var mastery = topic.Value;
                var color = mastery.Accuracy >= 90 ? "#90EE90" : mastery.Accuracy >= 75 ? "#FFD700" : mastery.Accuracy >= 50 ? "#FFA500" : "#FF6B6B";

                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin: 10px 0; border-left: 5px solid @color;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>@topic.Key.ToString()</strong>
                            <div style="font-size: 0.9em; color: #666;">@mastery.CorrectAnswers/@mastery.TotalAttempts correct</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 1.5em; font-weight: bold; color: @color;">@mastery.Accuracy.ToString("F0")%</div>
                            <div style="font-size: 0.9em; color: #666;">@mastery.MasteryLevel</div>
                        </div>
                    </div>
                    <div style="background: #e0e0e0; height: 8px; border-radius: 4px; margin-top: 10px; overflow: hidden;">
                        <div style="background: @color; height: 100%; width: @(mastery.Accuracy)%; transition: width 0.3s;"></div>
                    </div>
                </div>
            }

            @if (player.Achievements.Any())
            {
                <h3 style="color: var(--primary-pink); margin: 30px 0 15px 0;">🏆 Achievements</h3>
                <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                    @foreach (var achievement in player.Achievements)
                    {
                        <div style="background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); color: white; padding: 10px 20px; border-radius: 20px; font-weight: bold;">
                            @achievement
                        </div>
                    }
                </div>
            }

            <button class="btn" @onclick="BackToMenu" style="margin-top: 30px;">🏠 Back to Main Menu</button>
        </div>
    }
</div>




@using SmartGirlAlgebra.Services
@using SmartGirlAlgebra.Components
@using static SmartGirlAlgebra.Components.BalanceScale
@using static SmartGirlAlgebra.Components.EquationBuilder
@inject NavigationManager Navigation
@inject GameEngine gameEngine

@code {
    private Player? player;
    private string playerName = "";
    private string currentScreen = "welcome";
    private string activityTitle = "";
    private string activityType = "";
    private List<AlgebraQuestion> currentQuestions = new List<AlgebraQuestion>();
    private int currentQuestionIndex = 0;
    private int correctAnswers = 0;
    private string userAnswer = "";
    private bool isCorrect = false;
    private int bonusPomPoms = 0;
    private Random random = new Random();
    private int currentHintIndex = 0;
    private List<string> displayedHints = new List<string>();
    private List<string> wittyResponses = new List<string>();
    private string newAchievement = "";
    private bool showDiagnostic = false;

    // Navigation
    private List<string> navigationHistory = new List<string>();
    private List<string> savedPlayers = new List<string>();

    protected override async Task OnInitializedAsync()
    {
        // Load saved player names
        savedPlayers = await LocalStorage.GetItemAsync<List<string>>("savedPlayers") ?? new List<string>();

        // Try to load last player
        var lastPlayerName = await LocalStorage.GetItemAsync<string>("lastPlayer");
        if (!string.IsNullOrEmpty(lastPlayerName))
        {
            await LoadPlayer(lastPlayerName);
        }
    }

    // Interactive mode variables
    private string interactiveMode = "";
    private List<BalanceTerm> balanceLeftTerms = new();
    private List<BalanceTerm> balanceRightTerms = new();
    private int balanceSolution = 0;
    private string sliderExpression = "";
    private string sliderChallenge = "";
    private int? sliderTarget = null;
    private string builderProblem = "";
    private string builderAnswer = "";
    private List<EquationTile> builderTiles = new();

    // Interactive answer variables
    private int interactiveAnswer = 0;

    private List<int> GenerateOptions(int correctAnswer)
    {
        var options = new List<int> { correctAnswer };
        var random = new Random();

        while (options.Count < 4)
        {
            int offset = random.Next(-10, 11);
            if (offset == 0) offset = random.Next(1, 6);
            int option = correctAnswer + offset;
            if (!options.Contains(option) && option != 0)
            {
                options.Add(option);
            }
        }

        return options.OrderBy(x => random.Next()).ToList();
    }

    private void SelectTarget(int value)
    {
        interactiveAnswer = value;
    }

    private void AdjustBalance(int amount)
    {
        interactiveAnswer += amount;
    }

    private async Task CheckInteractiveAnswer()
    {
        userAnswer = interactiveAnswer.ToString();
        await CheckAnswer();
    }

    private async Task StartGame()
    {
        if (string.IsNullOrWhiteSpace(playerName))
        {
            return;
        }
        player = new Player(playerName);
        currentScreen = "menu";
        AddToHistory("menu");
        await SavePlayer();
    }

    private async Task LoadPlayer(string name)
    {
        var savedPlayer = await LocalStorage.GetItemAsync<Player>($"player_{name}");
        if (savedPlayer != null)
        {
            player = savedPlayer;
            playerName = name;
            currentScreen = "menu";
            AddToHistory("menu");
            await LocalStorage.SetItemAsync("lastPlayer", name);
        }
    }

    private async Task SavePlayer()
    {
        if (player == null) return;

        // Save player data
        await LocalStorage.SetItemAsync($"player_{player.Name}", player);

        // Add to saved players list if not already there
        if (!savedPlayers.Contains(player.Name))
        {
            savedPlayers.Add(player.Name);
            await LocalStorage.SetItemAsync("savedPlayers", savedPlayers);
        }

        // Save as last player
        await LocalStorage.SetItemAsync("lastPlayer", player.Name);
    }

    private async Task Logout()
    {
        await SavePlayer();
        player = null;
        playerName = "";
        currentScreen = "welcome";
        navigationHistory.Clear();
    }

    private void AddToHistory(string screen)
    {
        navigationHistory.Add(screen);
    }

    private void GoBack()
    {
        if (navigationHistory.Count > 1)
        {
            navigationHistory.RemoveAt(navigationHistory.Count - 1);
            currentScreen = navigationHistory[navigationHistory.Count - 1];
        }
    }

    private void GoHome()
    {
        if (player != null)
        {
            currentScreen = "menu";
            navigationHistory.Clear();
            AddToHistory("menu");
        }
    }

    private void StartDiagnostic()
    {
        activityType = "diagnostic";
        activityTitle = "🎯 Quick Diagnostic Assessment";
        currentQuestions = gameEngine.GenerateDiagnosticQuiz();
        currentQuestionIndex = 0;
        correctAnswers = 0;
        currentScreen = "question";
        AddToHistory("question");
        ResetQuestionState();
    }

    private void StartActivity(string type)
    {
        activityType = type;
        currentQuestionIndex = 0;
        correctAnswers = 0;
        bonusPomPoms = 0;

        switch (type)
        {
            case "adaptive":
                activityTitle = "🎯 Adaptive Training - Personalized for YOU";
                currentQuestions = gameEngine.GenerateAdaptiveQuestions(player!, 5);
                break;
            case "practice":
                activityTitle = "📚 Practice Mode - Mixed Topics";
                currentQuestions = gameEngine.GenerateAdaptiveQuestions(player!, 3);
                break;
            case "challenge":
                activityTitle = "🏆 Challenge Mode - Expert Level";
                currentQuestions = gameEngine.GenerateAdaptiveQuestions(player!, 7);
                break;
        }

        currentScreen = "question";
        AddToHistory("question");
        ResetQuestionState();
    }

    private void ResetQuestionState()
    {
        userAnswer = "";
        currentHintIndex = 0;
        displayedHints.Clear();
        wittyResponses.Clear();
        newAchievement = "";
    }

    private void ShowHint()
    {
        if (currentHintIndex < currentQuestions[currentQuestionIndex].Hints.Count)
        {
            displayedHints.Add(currentQuestions[currentQuestionIndex].Hints[currentHintIndex]);
            currentHintIndex++;
            player!.HintsUsed++;
        }
    }

    private void HandleKeyPress(KeyboardEventArgs e)
    {
        if (e.Key == "Enter")
        {
            CheckAnswer();
        }
    }

    private async Task CheckAnswer()
    {
        if (string.IsNullOrWhiteSpace(userAnswer)) return;

        var question = currentQuestions[currentQuestionIndex];
        isCorrect = question.IsCorrect(userAnswer);

        // Update topic mastery
        player!.UpdateTopicMastery(question.Topic, isCorrect);

        if (isCorrect)
        {
            correctAnswers++;
            player.IncrementStreak();

            // Calculate points based on difficulty and hints used
            int basePoints = question.Difficulty * 10;
            int hintPenalty = currentHintIndex * 2;
            int streakBonus = Math.Min(player.Streak * 2, 20);
            int points = Math.Max(basePoints - hintPenalty + streakBonus, 5);

            player.AddPoints(points);

            // Get witty responses
            wittyResponses = gameEngine.GetWittyCorrectResponse(player.Streak, currentHintIndex > 0);

            // Check for achievements
            CheckAchievements();

            // Auto-save progress
            await SavePlayer();
        }
        else
        {
            player.ResetStreak();
            wittyResponses = new List<string> { gameEngine.GetWittyIncorrectResponse(currentQuestionIndex - correctAnswers) };
        }

        currentScreen = "feedback";
    }

    private void CheckAchievements()
    {
        if (correctAnswers == 1 && !player!.Achievements.Contains("first_correct"))
        {
            player.AddAchievement("first_correct");
            newAchievement = gameEngine.GetAchievementMessage("first_correct");
        }

        if (player!.Streak == 5 && !player.Achievements.Contains("streak_5"))
        {
            player.AddAchievement("streak_5");
            newAchievement = gameEngine.GetAchievementMessage("streak_5");
            player.AddPomPoms(2);
        }

        if (player.Streak == 10 && !player.Achievements.Contains("streak_10"))
        {
            player.AddAchievement("streak_10");
            newAchievement = gameEngine.GetAchievementMessage("streak_10");
            player.AddPomPoms(5);
        }

        if (currentHintIndex == 0 && !player.Achievements.Contains("no_hints_master"))
        {
            player.AddAchievement("no_hints_master");
            newAchievement = gameEngine.GetAchievementMessage("no_hints_master");
        }
    }

    private void NextQuestion()
    {
        currentQuestionIndex++;

        if (currentQuestionIndex < currentQuestions.Count)
        {
            currentScreen = "question";
            ResetQuestionState();
        }
        else
        {
            ShowResults();
        }
    }

    private async Task ShowResults()
    {
        double percentage = (double)correctAnswers / currentQuestions.Count * 100;
        await SavePlayer();

        if (percentage >= 80)
        {
            player!.LevelUp();
        }

        if (activityType == "competition" && correctAnswers >= 4)
        {
            bonusPomPoms = random.Next(1, 4);
            player!.AddPomPoms(bonusPomPoms);
        }

        currentScreen = "results";
    }

    private void BackToMenu()
    {
        currentScreen = "menu";
    }

    private void ViewProgress()
    {
        currentScreen = "progress";
        AddToHistory("progress");
    }

    private void StartInteractiveMode(string mode)
    {
        interactiveMode = mode;
        currentScreen = "interactive";
        AddToHistory("interactive");

        switch (mode)
        {
            case "balance":
                SetupBalanceScale();
                break;
            case "slider":
                SetupSliderPlayground();
                break;
            case "builder":
                SetupEquationBuilder();
                break;
        }
    }

    private void SetupBalanceScale()
    {
        // Example: 2x + 3 = 11
        balanceLeftTerms = new List<BalanceTerm>
        {
            new BalanceTerm { Display = "2x", Type = "variable", Value = 0, Weight = 0 },
            new BalanceTerm { Display = "+", Type = "operator", Value = 0, Weight = 0 },
            new BalanceTerm { Display = "3", Type = "number", Value = 3, Weight = 3 }
        };

        balanceRightTerms = new List<BalanceTerm>
        {
            new BalanceTerm { Display = "11", Type = "number", Value = 11, Weight = 11 }
        };

        balanceSolution = 4;
    }

    private void SetupSliderPlayground()
    {
        sliderExpression = "3x + 7";
        sliderChallenge = "Can you make the expression equal to 22?";
        sliderTarget = 22;
    }

    private void SetupEquationBuilder()
    {
        builderProblem = "Sarah has 5 more apples than twice the number of oranges. If she has 13 apples, how many oranges does she have?";
        builderAnswer = "2x+5=13";

        builderTiles = new List<EquationTile>
        {
            new EquationTile { Display = "x", Type = "variable", Hint = "Number of oranges" },
            new EquationTile { Display = "2", Type = "number" },
            new EquationTile { Display = "5", Type = "number" },
            new EquationTile { Display = "13", Type = "number" },
            new EquationTile { Display = "+", Type = "operator" },
            new EquationTile { Display = "×", Type = "operator" },
            new EquationTile { Display = "=", Type = "equals" }
        };
    }

    private async Task HandleInteractiveSolved(bool success)
    {
        if (success)
        {
            player!.AddPoints(50);
            player.AddPomPoms(1);

            // Show success message
            await Task.Delay(2000);

            // Generate new challenge
            switch (interactiveMode)
            {
                case "balance":
                    SetupBalanceScale();
                    break;
                case "slider":
                    SetupSliderPlayground();
                    break;
                case "builder":
                    SetupEquationBuilder();
                    break;
            }
        }
    }
}